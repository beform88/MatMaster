name: Check Sharing URLs

on:
  pull_request:
    paths:
      - "agents/matmaster_agent/recommend_question.json"

jobs:
  validate-sharing-url:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Install jq
        run: sudo apt-get install -y jq

      - name: Validate sharing_url
        run: |
          FILE="agents/matmaster_agent/recommend_question.json"

          echo "Checking sharing_url fields in $FILE ..."

          # ä»…æå– sharing_url æ˜¯ object çš„æƒ…å†µ
          urls=$(jq -r '
            .questions[].zhPrompt.sharing_url
            | select(type == "object")
            | to_entries[]
            | .value
          ' "$FILE")

          invalid_found=0

          while IFS= read -r url; do
            if [[ "$url" == "" || "$url" == "null" ]]; then
              echo "âš ï¸ Warning: Found empty sharing_url value"
              continue
            fi

            if [[ "$url" != *"share"* ]]; then
              echo "âŒ Invalid URL (missing '\''share'\''): $url"
              invalid_found=1
            else
              echo "âœ”ï¸ OK: $url"
            fi
          done <<< "$urls"

          if [[ $invalid_found -ne 0 ]]; then
            echo "âŒ Some sharing_url entries do NOT contain '\''share'\''."
            exit 1
          fi

          echo "ğŸ‰ All sharing_url entries are valid!"
